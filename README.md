# 日本語ボイスクローン

Coqui TTSを使用した日本語専用ボイスクローンシステムです。XTTS v2モデルを使用して、サンプル音声から話者の声の特徴を学習し、新しいテキストを同じ声で合成することができます。

## 特徴

- 💬 **日本語に特化**: 日本語テキストの読み上げに最適化されています
- 📊 **最先端の音声合成**: XTTS v2モデルによる高品質な自然音声
- 🎛️ **調整可能なパラメータ**: ノイズ除去や発話の長さを調整できます
- 🚀 **GPU対応**: NVIDIAのGPUを使用して高速に処理します
- 🐋 **Docker対応**: 環境構築の手間なく簡単に実行できます

## 必要条件

- Docker
- NVIDIA GPU + ドライバー（推奨）
- NVIDIA Container Toolkit

## 使い方

### 1. 声のサンプルを準備する

クローンしたい声のサンプル音声（WAVファイル）を `samples/voice.wav` として保存してください。
音声は以下の条件を満たすことをお勧めします：

- 10〜30秒程度の長さ
- クリアな音質で背景ノイズが少ない
- サンプリングレート: 44.1kHzまたは48kHz
- ビット深度: 16bit
- チャンネル: モノラル

### 2. スクリプトを実行する

```bash
./run_voice_clone.sh "合成したい日本語テキスト" [ノイズ除去強度] [長さペナルティ]
```

#### パラメータ：

- **テキスト**: 合成する日本語テキスト（必須）
- **ノイズ除去強度**: 0.0〜1.0の値（デフォルト: 0.005、大きいほど強い）
- **長さペナルティ**: 通常は0.5〜2.0の値（デフォルト: 1.0、大きいほど長く発話）

#### 例：

```bash
./run_voice_clone.sh "こんにちは、これはテストです。" 0.01 1.2
```

### 3. 出力ファイル

生成された音声ファイルは `output/` ディレクトリに保存されます。ファイル名は実行日時に基づいて自動的に設定されます。

## トラブルシューティング

- **GPUエラー**: GPUが認識されない場合、Docker設定でGPUが正しく有効になっているか確認してください。
- **音声が聞き取りにくい**: 別の音声サンプルを試してみてください。
- **モデルロードエラー**: PyTorch 2.6のweights_onlyパラメータの問題が発生した場合、スクリプトは自動的に対処します。

## 技術的詳細

このシステムは以下の技術を使用しています：

- Coqui TTS 0.22.0（XTTS v2モデル）
- PyTorch 2.0.1
- CUDA 11.8
- 日本語音声処理のための特殊なライブラリ（MeCab、pyopenjtalk-prebuilt等）

## XTTS v2モデルについて

XTTS v2は最新のボイスクローン技術を搭載したCoqui TTSの高度な音声合成モデルです：

- 多言語対応（日本語を含む30以上の言語）
- わずか数秒の音声サンプルでボイスクローンが可能
- 自然な韻律と感情表現
- 異言語間のボイスクローン（例：日本語の声で英語を発話）
- 24kHzサンプリングレートによる高品質な音声出力

## ファイル構成

- `Dockerfile`: TTSをインストールするためのDockerfile
- `docker-compose.yml`: Docker Compose設定ファイル
- `voice_clone.py`: ボイスクローン用Pythonスクリプト
- `run_voice_clone.sh`: 簡単に実行するためのシェルスクリプト
- `samples/`: 入力音声を保存するディレクトリ
- `output/`: 生成された音声を保存するディレクトリ

## 注意点

- 初回実行時はモデルのダウンロードが行われるため、時間がかかります
- RTX 3050は4GB VRAMのため、モデル実行に十分なメモリがあります
- WSL2でGPUを使用するには、ホストマシンに適切なNVIDIAドライバがインストールされている必要があります

## モデルオプション

- `tts_models/multilingual/multi-dataset/your_tts`: YourTTSモデル（デフォルト）
- その他のモデルは `tts.list_models()` で確認できます

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。
使用するCoqui TTSはMPL-2.0ライセンスです。 